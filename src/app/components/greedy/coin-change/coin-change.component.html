<div class="coin-change-visualization">
  <div class="problem-info">
    <h4>ğŸ’° ç¡¬è²¨å•é¡Œ (è²ªæ¬²æ³•)</h4>
    <div class="target-amount">æ”¯æ‰•é‡‘é¡: {{ targetAmount }}å††</div>
    <div class="result-summary">{{ getResultText() }}</div>
  </div>

  <!-- ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º -->
  @if (currentCoinIndex >= 0) {
    <div class="current-step">
      <strong>ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong> {{ getCurrentStepText() }}
    </div>
  }

  <!-- ç¡¬è²¨ã®è¡¨ç¤º -->
  <div class="coins-section">
    <h4>ğŸª™ åˆ©ç”¨å¯èƒ½ãªç¡¬è²¨</h4>
    <div class="coins-grid">
      @for (coin of coins; track $index) {
        <div class="coin-container" [class]="getCoinClass($index)">
          <div class="coin-visual" 
               [style.width.px]="getCoinSize(coin.value)"
               [style.height.px]="getCoinSize(coin.value)"
               [style.background-color]="getCoinColor(coin.value)">
            <span class="coin-value">{{ coin.value }}</span>
          </div>
          
          <div class="coin-info">
            <div class="coin-label">{{ getCoinValueText(coin) }}</div>
            
            @if (coin.used > 0) {
              <div class="usage-info">
                <span class="used-count">{{ coin.used }}æšä½¿ç”¨</span>
                <div class="used-coins">
                  @for (i of [].constructor(Math.min(coin.used, 5)); track $index) {
                    <div class="mini-coin" 
                         [style.background-color]="getCoinColor(coin.value)">
                      {{ coin.value }}
                    </div>
                  }
                  @if (coin.used > 5) {
                    <span class="more-coins">+{{ coin.used - 5 }}</span>
                  }
                </div>
              </div>
            } @else if (currentCoinIndex === $index) {
              <div class="calculating">è¨ˆç®—ä¸­...</div>
            } @else if ($index < currentCoinIndex || isComplete) {
              <div class="not-used">ä½¿ç”¨ã›ãš</div>
            }
          </div>
        </div>
      }
    </div>
  </div>

  <!-- è¨ˆç®—éç¨‹ã®è¡¨ç¤º -->
  @if (steps.length > 0) {
    <div class="steps-section">
      <h4>ğŸ“‹ è¨ˆç®—ã‚¹ãƒ†ãƒƒãƒ—</h4>
      <div class="steps-list">
        @for (step of steps; track $index) {
          <div class="step-item">
            <span class="step-number">{{ $index + 1 }}.</span>
            <span class="step-text">{{ step }}</span>
          </div>
        }
      </div>
    </div>
  }

  <!-- çµæœçµ±è¨ˆ -->
  @if (isComplete) {
    <div class="result-section">
      <h4>ğŸ“Š çµæœçµ±è¨ˆ</h4>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-label">åˆè¨ˆç¡¬è²¨æ•°</div>
          <div class="stat-value">{{ totalCoinsUsed }}æš</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ”¯æ‰•å®Œäº†</div>
          <div class="stat-value">{{ remainingAmount === 0 ? 'ã¯ã„' : 'ã„ã„ãˆ' }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ®‹é‡‘</div>
          <div class="stat-value">{{ remainingAmount }}å††</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </div>
          <div class="stat-value">è²ªæ¬²æ³•</div>
        </div>
      </div>
      
      @if (remainingAmount === 0) {
        <div class="success-message">
          âœ… æœ€é©è§£ï¼è²ªæ¬²æ³•ã§æœ€å°‘æšæ•°ã§ã®æ”¯æ‰•ã„ãŒå®Œäº†ã—ã¾ã—ãŸã€‚
        </div>
      }
    </div>
  }

  <div class="legend">
    <div class="legend-item">
      <div class="legend-color current"></div>
      <span>ç¾åœ¨æ¤œè¨ä¸­</span>
    </div>
    <div class="legend-item">
      <div class="legend-color used"></div>
      <span>ä½¿ç”¨ã•ã‚ŒãŸç¡¬è²¨</span>
    </div>
    <div class="legend-item">
      <div class="legend-color processed"></div>
      <span>æ¤œè¨æ¸ˆã¿</span>
    </div>
    <div class="legend-item">
      <div class="legend-color silver"></div>
      <span>500/100/50å††ç¡¬è²¨</span>
    </div>
    <div class="legend-item">
      <div class="legend-color bronze"></div>
      <span>10/5/1å††ç¡¬è²¨</span>
    </div>
  </div>
</div>