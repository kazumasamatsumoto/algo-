<div class="euclidean-gcd-visualization">
  <div class="problem-info">
    <h4>ğŸ”¢ ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•</h4>
    <div class="numbers-display">
      <span class="number-label">æ•°å€¤A:</span>
      <span class="number-value">{{ originalA }}</span>
      <span class="number-label">æ•°å€¤B:</span>
      <span class="number-value">{{ originalB }}</span>
    </div>
    <div class="result-summary">{{ getResultText() }}</div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
  <div class="mode-selection">
    <button 
      class="mode-btn"
      [class.active]="!extendedMode"
      [disabled]="isRunning"
      (click)="toggleExtendedMode()">
      åŸºæœ¬ç‰ˆ
    </button>
    <button 
      class="mode-btn"
      [class.active]="extendedMode"
      [disabled]="isRunning"
      (click)="toggleExtendedMode()">
      æ‹¡å¼µç‰ˆ
    </button>
  </div>

  <!-- ç¾åœ¨ã®æ“ä½œè¡¨ç¤º -->
  @if (getCurrentOperationText()) {
    <div class="current-operation">
      <strong>ç¾åœ¨ã®è¨ˆç®—:</strong> {{ getCurrentOperationText() }}
    </div>
  }

  <div class="main-content">
    <!-- è¦–è¦šçš„è¡¨ç¾ -->
    <div class="visual-section">
      <h4>ğŸ“Š æ•°å€¤ã®è¦–è¦šåŒ–</h4>
      
      <!-- æ•°å€¤Aã®è¡¨ç¾ -->
      <div class="number-visualization">
        <div class="number-header">
          <span class="number-title">A = {{ originalA }}</span>
          @if (isComplete && getPrimeFactors(originalA)) {
            <span class="prime-factors">{{ getPrimeFactors(originalA) }}</span>
          }
        </div>
        <div class="blocks-container">
          @for (block of getNumberBlocks(originalA); track $index) {
            <div [class]="getBlockClass(originalA, $index)"></div>
          }
        </div>
      </div>

      <!-- æ•°å€¤Bã®è¡¨ç¾ -->
      <div class="number-visualization">
        <div class="number-header">
          <span class="number-title">B = {{ originalB }}</span>
          @if (isComplete && getPrimeFactors(originalB)) {
            <span class="prime-factors">{{ getPrimeFactors(originalB) }}</span>
          }
        </div>
        <div class="blocks-container">
          @for (block of getNumberBlocks(originalB); track $index) {
            <div [class]="getBlockClass(originalB, $index)"></div>
          }
        </div>
      </div>

      <!-- GCDã®è¡¨ç¾ -->
      @if (isComplete) {
        <div class="gcd-visualization">
          <div class="number-header">
            <span class="number-title gcd-title">GCD = {{ gcdResult }}</span>
            @if (getPrimeFactors(gcdResult)) {
              <span class="prime-factors">{{ getPrimeFactors(gcdResult) }}</span>
            }
          </div>
          <div class="blocks-container">
            @for (block of getNumberBlocks(gcdResult); track $index) {
              <div class="number-block gcd-block"></div>
            }
          </div>
        </div>
      }
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º -->
    <div class="steps-section">
      <h4>ğŸ“ è¨ˆç®—ã‚¹ãƒ†ãƒƒãƒ—</h4>
      
      @if (!extendedMode) {
        <!-- åŸºæœ¬ç‰ˆã®ã‚¹ãƒ†ãƒƒãƒ— -->
        <div class="steps-container">
          @for (step of steps; track step.step) {
            <div [class]="getStepClass(step.step)">
              <div class="step-number">Step {{ step.step + 1 }}</div>
              <div class="step-content">
                <div class="step-equation">{{ step.operation }}</div>
                <div class="step-details">
                  <span>å•†: {{ step.quotient }}</span>
                  <span>ä½™ã‚Š: {{ step.remainder }}</span>
                </div>
              </div>
              @if (step.remainder === 0) {
                <div class="step-conclusion">
                  âœ… ä½™ã‚ŠãŒ0ã«ãªã£ãŸã®ã§ã€GCD = {{ step.b }}
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <!-- æ‹¡å¼µç‰ˆã®ã‚¹ãƒ†ãƒƒãƒ— -->
        <div class="extended-steps-container">
          <div class="extended-header">
            <span>a</span>
            <span>b</span>
            <span>å•†(q)</span>
            <span>x</span>
            <span>y</span>
          </div>
          @for (step of extendedSteps; track $index) {
            <div class="extended-step" [class.current]="currentStepIndex === $index">
              <span class="step-value">{{ step.a }}</span>
              <span class="step-value">{{ step.b }}</span>
              <span class="step-value">{{ step.q || '-' }}</span>
              <span class="step-value">{{ step.x }}</span>
              <span class="step-value">{{ step.y }}</span>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- çµæœçµ±è¨ˆ -->
  @if (isComplete) {
    <div class="result-section">
      <h4>ğŸ“ˆ çµæœçµ±è¨ˆ</h4>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-label">æœ€å¤§å…¬ç´„æ•°</div>
          <div class="stat-value">{{ gcdResult }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æœ€å°å…¬å€æ•°</div>
          <div class="stat-value">{{ getLcm() }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">è¨ˆç®—ã‚¹ãƒ†ãƒƒãƒ—æ•°</div>
          <div class="stat-value">{{ steps.length }}</div>
        </div>
        @if (extendedMode) {
          <div class="stat-item">
            <div class="stat-label">ãƒ™ã‚ºãƒ¼ä¿‚æ•°</div>
            <div class="stat-value">x={{ coefficients.x }}, y={{ coefficients.y }}</div>
          </div>
        }
      </div>
      
      <div class="additional-info">
        <div class="info-item">
          <strong>æ¤œè¨¼:</strong> 
          {{ originalA }} Ã· {{ gcdResult }} = {{ originalA / gcdResult }}, 
          {{ originalB }} Ã· {{ gcdResult }} = {{ originalB / gcdResult }}
        </div>
        @if (extendedMode) {
          <div class="info-item">
            <strong>ãƒ™ã‚ºãƒ¼ã®ç­‰å¼:</strong>
            {{ originalA }} Ã— {{ coefficients.x }} + {{ originalB }} Ã— {{ coefficients.y }} = {{ gcdResult }}
          </div>
          <div class="info-item">
            <strong>æ¤œè¨¼:</strong>
            {{ originalA * coefficients.x }} + {{ originalB * coefficients.y }} = {{ originalA * coefficients.x + originalB * coefficients.y }}
          </div>
        }
      </div>
    </div>
  }

  <!-- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ èª¬æ˜ -->
  <div class="algorithm-info">
    <h4>ğŸ“š ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã¤ã„ã¦</h4>
    <div class="info-content">
      <div class="basic-info">
        <h5>ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ã®äº’é™¤æ³•ã¨ã¯</h5>
        <p>2ã¤ã®è‡ªç„¶æ•°ã®æœ€å¤§å…¬ç´„æ•°ã‚’åŠ¹ç‡çš„ã«æ±‚ã‚ã‚‹å¤ä»£ã‚®ãƒªã‚·ãƒ£ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚</p>
        
        <h5>åŸºæœ¬ã®æ‰‹é †</h5>
        <ol>
          <li>å¤§ãã„æ•°ã‚’å°ã•ã„æ•°ã§å‰²ã‚‹</li>
          <li>ä½™ã‚Šã‚’æ±‚ã‚ã‚‹</li>
          <li>å°ã•ã„æ•°ã¨ä½™ã‚Šã§åŒã˜æ“ä½œã‚’ç¹°ã‚Šè¿”ã™</li>
          <li>ä½™ã‚ŠãŒ0ã«ãªã£ãŸã¨ãã®é™¤æ•°ãŒGCD</li>
        </ol>

        @if (extendedMode) {
          <h5>æ‹¡å¼µãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰äº’é™¤æ³•</h5>
          <p>GCDã ã‘ã§ãªãã€ãƒ™ã‚ºãƒ¼ã®ç­‰å¼ ax + by = gcd(a,b) ã®ä¿‚æ•°x, yã‚‚æ±‚ã‚ã¾ã™ã€‚</p>
        }
      </div>
      
      <div class="complexity-info">
        <div class="complexity-item">
          <span class="label">æ™‚é–“è¨ˆç®—é‡:</span>
          <span class="value">O(log min(a,b))</span>
        </div>
        <div class="complexity-item">
          <span class="label">ç©ºé–“è¨ˆç®—é‡:</span>
          <span class="value">O(1)</span>
        </div>
        <div class="complexity-item">
          <span class="label">å¿œç”¨åˆ†é‡:</span>
          <span class="value">æš—å·å­¦ã€æ•°è«–</span>
        </div>
      </div>
    </div>
  </div>

  <!-- å‡¡ä¾‹ -->
  <div class="legend">
    <div class="legend-item">
      <div class="legend-color current"></div>
      <span>ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—</span>
    </div>
    <div class="legend-item">
      <div class="legend-color completed"></div>
      <span>å®Œäº†ã—ãŸã‚¹ãƒ†ãƒƒãƒ—</span>
    </div>
    <div class="legend-item">
      <div class="legend-color gcd"></div>
      <span>æœ€å¤§å…¬ç´„æ•°éƒ¨åˆ†</span>
    </div>
    <div class="legend-item">
      <div class="legend-color remainder"></div>
      <span>ä½™ã‚Šéƒ¨åˆ†</span>
    </div>
  </div>
</div>